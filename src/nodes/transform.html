<script type="text/javascript">
    RED.nodes.registerType('transform',{
        category: 'FileMaker',
        defaults: {
          parameters: { value: null, required: false }
        },
        inputs:1,
        outputs:1,
        icon: 'transform.png',
        color: '#39D1C0',
        label: "Transform Response"
    });
</script>

<script type="text/x-red" data-template-name="transform">
    <div class="form-row">
        <label for="node-input-parameters">Default Parameters</label>
        <input type="text" id="node-input-parameters">
    </div>
</script>
<script type="text/x-red" data-help-name="edit-record">
<p>This node edits a specific record in FileMaker. It uses the recordId it finds in
<code>msg.payload.recordId</code> to specify the record to edit. It uses the data found
in <code>msg.payload.data</code> to update the record.</p>

This node will use the default layout set in its configuration or 
a layout specified in <code>msg.parameters</code> or <code>msg.payload</code> .

<h3>Inputs</h3>
    <dl class="message-properties">
        <dt>payload
            <span class="property-type">object</span>
            <dd><b>data</b> <mark>required</mark> - <i>object</i><br>The data to edit</dd>
            <dd><b>parameters</b> - <i>object</i><br>The parameters to use for the transformation</dd>
        </dt>
        <dt class="optional">parameters <span class="property-type">object</span>
            <dd><b>layout</b> - <i>string</i><br>The layout to use when creating a record. Defaults to node configuration.</dd>
            <dd><b>scripts</b> - <i>array</i><br>Any FileMaker scripts to run when creating a record.</dd>
        </dt>
    </dl>

 <h3>Outputs</h3>
     <ol class="node-ports">
         <li>Standard output
             <dl class="message-properties">
                <dt>payload<span class="property-type">object</span>
                    <dd><b>data</b> - <i>object</i><br>The transformed data</dd>
                </dt>
             </dl>
         </li>
         <li>Standard error
             <dl class="message-properties">
                 <dt>payload <span class="property-type">object</span></dt>
                    <dd><b>message</b><i> - string </i><br>The FileMaker or client error message.</dd>
                    <dd><b>code</b> - <i>string </i><br>The applicible FileMaker error code.</dd>
             </dl>
         </li>
     </ol>

<h3>Details</h3>
    <p>This node will transform the data found in <code>msg.payload.data</code> from 
    an object with `fieldData` and `portalData` propertiesto an object with array 
    properties for portal data. converts Data API response data by converting 
    table::field properties to objects. This method will transverse the response data
     and converting { table::field : value} properties to { table:{ field : value } }.
     The transform method will also convert portalData into arrays of objects. The transform
      method accepts three option properties. The three option properties are all booleans 
      and true by default. The three option properties are convert,fieldData,portalData. 
      The convert property controls the transfomation of table::field properties. 
      The fieldData property controls the merging of fieldData to the result. 
      The portalData property controls the merging of portalData to the result.
      Setting any propery to false its transformation off.</p>

<h3>References</h3>
    <ul>
        <li><a href="https://github.com/Luidog/fms-api-client#transform-method">Transform Method</a> - Base client documentation</li>
        <li><a href="https://github.com/Luidog/node-red-contrib-filemaker">node-red-contrib-filemaker</a> - the node's github repository</li>
        <li><a href="https://github.com/Luidog/fms-api-client">fms-api-client</a> - fms-api-client github repository</li>
    </ul>
</script>