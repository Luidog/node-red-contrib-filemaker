<script type="text/javascript">
    RED.nodes.registerType("transform", {
      category: "FileMaker",
      defaults: {
        parameters: { value: null, required: false }
      },
      inputs: 1,
      outputs: 1,
      icon: "transform.png",
      color: "#39D1C0",
      label: "Transform Response"
    });
</script>

<script type="text/x-red" data-template-name="transform">
    <div class="form-row">
        <label for="node-input-parameters">Default Parameters</label>
        <input type="text" id="node-input-parameters">
    </div>
</script>
<script type="text/x-red" data-help-name="transform">
  <p>This node transforms data in <code>msg.payload.data</code>. it reduces <code>{ table::field : value }</code> properties to <code>{ table: { field : value } }</code></p>

  <h3>Inputs</h3>
      <dl class="message-properties">
          <dt>payload
              <span class="property-type">object</span>
              <dd><b>data</b> <mark>required</mark> - <i>object</i><br>The data to edit</dd>
              <dd><b>parameters</b> - <i>object</i><br> see optional parameter object</dd>
          </dt>
          <dt class="optional">parameters <span class="property-type">object</span>
              <dd><b>convert</b> - <i>boolean</i><br>convert table::field properties.</dd>
              <dd><b>fieldData</b> - <i>boolean</i><br>merge fieldData property into object.</dd>
              <dd><b>portalData</b> - <i>boolean</i><br>merge portalData property into object</dd>
          </dt>
      </dl>

  <h3>Outputs</h3>
     <ol class="node-ports">
         <li>Standard output
             <dl class="message-properties">
                <dt>payload<span class="property-type">object</span>
                    <dd><b>data</b> - <i>object</i><br>The transformed data</dd>
                </dt>
             </dl>
         </li>
         <li>Standard error
            <dl class="message-properties">
                 <dt>message <span class="property-type">Object</span></dt>
                    <dd><b>message</b> - <i>String</i><br>The FileMaker or client error message.</dd>
                    <dd><b>code</b> - <i>String</i><br>The applicible FileMaker error code.</dd>
             </dl>
         </li>
     </ol>

<h3>Details</h3>
    <p>This node converts Data API record data. This method will traverse the response data
     and convert <code>{ table::field : value }</code> properties to <code>{ table: { field : value } }</code>. This node will also move portalData properties into arrays the main object. The transform method accepts three option properties. The three option properties are all booleans and true by default. The three option properties are convert, fieldData, portalData. The convert property controls the transformation of table::field properties. The fieldData property controls the merging of fieldData to the result. The portalData property controls the merging of portalData to the result. Setting any propery to false its transformation off.</p>

<h3>References</h3>
    <ul>
        <li><a href="https://github.com/Luidog/fms-api-client#transform-method">Transform Method</a> - Base client documentation</li>
        <li><a href="https://github.com/Luidog/node-red-contrib-filemaker">node-red-contrib-filemaker</a> - the node's github repository</li>
        <li><a href="https://github.com/Luidog/fms-api-client">fms-api-client</a> - fms-api-client github repository</li>
    </ul>
</script>