<script type="text/javascript">
    RED.nodes.registerType("list-records", {
      category: "FileMaker",
      defaults: {
        client: { value: null, type: "filemaker-api-client", required: true },
        layout: { value: 'layout', validate:RED.validators.typedInput("layoutType"), required: true },
        layoutType: {value:"msg"},
        limit: { value: null, required: false },
        limitType: {value:"num"},
        offset: { value: null, required: false },
        offsetType: { value:"num" },
        sort: { value: "{}", required: false },
        sortType: {value:"json"},
        scripts: { value: null, required: false },
        scriptsType: {value:"json"},
        portals: { value: null, required: false },
        portalsType: {value:"json"},
        output: { value: "payload", required: false }
      },
      inputs: 1,
      outputs: 1,
      icon: "list.png",
      color: "#39D1C0",
      label: "List Records",
      oneditprepare: function() {
        $("#node-input-layout").typedInput({
          default: 'str',
          types: ['str','msg','flow','global'],
          typeField: $("#node-input-layoutType")
        });
        $("#node-input-layout").typedInput({
          default: 'str',
          types: ['str','msg','flow','global'],
          typeField: $("#node-input-layoutType")
        });
        $("#node-input-limit").typedInput({
          default: 'num',
          types: ['num','msg','flow','global'],
          typeField: $("#node-input-limitType")
        });
        $("#node-input-offset").typedInput({
          default: 'num',
          types: ['num','msg','flow','global'],
          typeField: $("#node-input-offsetType")
        });
        $("#node-input-sort").typedInput({
          default: 'json',
          types: ['json','msg','flow','global'],
          typeField: $("#node-input-sortType")
        });
        $("#node-input-scripts").typedInput({
          default: 'json',
          types: ['json','msg','flow','global'],
          typeField: $("#node-input-scriptsType")
        });
        $("#node-input-portals").typedInput({
          default: 'json',
          types: ['json','msg','flow','global'],
          typeField: $("#node-input-portalsType")
        });
        $("#node-input-output").typedInput({
          default: 'msg',
          types: ['msg']
        });
      }
    });
</script>

<script type="text/x-red" data-template-name="list-records">
    <div class="form-row">
        <label for="node-input-client">DAPI Client</label>
        <input type="text" id="node-input-client">
    </div>
    <div class="form-row">
        <label for="node-input-layout">Layout</label>
        <input type="hidden" id="node-input-layoutType">
        <input type="text" id="node-input-layout">
    </div>
    <div class="form-row">
        <label for="node-input-limit">Limit</label>
        <input type="hidden" id="node-input-limitType">
        <input type="text" id="node-input-limit">
    </div>
    <div class="form-row">
        <label for="node-input-offset">Offset</label>
        <input type="hidden" id="node-input-offsetType">
        <input type="text" id="node-input-offset">
    </div>
    <div>
      <hr>
    </div>
    <div class="form-row">
        <label for="node-input-scripts">Sort</label>
        <input type="hidden" id="node-input-sortType">
        <input type="text" id="node-input-sort">
    </div>
    <div class="form-row">
        <label for="node-input-scripts">Scripts</label>
        <input type="hidden" id="node-input-scriptsType">
        <input type="text" id="node-input-scripts">
    </div>
    </div>
        <div class="form-row">
        <label for="node-input-scripts">Portals</label>
        <input type="hidden" id="node-input-portalsType">
        <input type="text" id="node-input-portals">
    </div>
    <hr>
    <div class="form-row">
        <label for="node-input-output">Output</label>
        <input type="text" id="node-input-output">
    </div>
</script>

<script type="text/x-red" data-help-name="list-records">
<p>Lists FileMaker records for the specified layout. This node will use the layout set in its configuration or a layout specified in <code>msg.parameters</code> or <code>msg.payload</code>.</p>

<h3>Inputs</h3>
    <dl class="message-properties">
        <dt>payload
            <span class="property-type">Object</span>
                <dd><b>layout</b> - <i>String</i><br>The layout to use for the list. Defaults to node configuration.</dd>
                <dd><b>limit</b> - <i>Number</i><br>The number of records to return in the list. Default is 100.</dd>
                <dd><b>offset</b> - <i>Array</i><br>The position to start listing records from.</dd>
                <dd><b>sort</b> - <i>Object</i><br>The sort order of the records.</dd>
                <dd><b>portals</b> - <i>Array</i><br>An arry of portals to return with the list</dd>
                <dd><b>scripts</b> - <i>Array</i><br>The FileMaker scripts to run when listing records</dd>
            </dt>
            <dt class="optional">parameters <span class="property-type">Object</span>
                <dd><b>layout</b> - <i>String</i><br>The layout to use for the find. Defaults to node configuration.</dd>
                <dd><b>limit</b> - <i>Number</i><br>The number of records to return in the list. Default is 100.</dd>
                <dd><b>offset</b> - <i>Array</i><br>The position to start listing records from.</dd>
                <dd><b>sort</b> - <i>Object</i><br>The sort order of the records.</dd>
                <dd><b>portals</b> - <i>Array</i><br>An arry of portals to return with the list</dd>
                <dd><b>scripts</b> - <i>Array</i><br>The FileMaker scripts to run when listing records.</dd>
            </dt>
    </dl>

 <h3>Outputs</h3>
     <ol class="node-ports">
         <li>Standard output
             <dl class="message-properties">
                 <dt>payload <span class="property-type">Object</span></dt>
                 <dd>Contains the FileMaker Data API Response.</dd>
             </dl>
         </li>
         <li>Standard error
             <dl class="message-properties">
                 <dt>message <span class="property-type">Object</span></dt>
                    <dd><b>message</b> - <i>String</i><br>The FileMaker or client error message.</dd>
                    <dd><b>code</b> - <i>String</i><br>The applicible FileMaker error code.</dd>
             </dl>
         </li>
     </ol>

<h3>Details</h3>
    <p>This node will use the query found in <code>msg.payload.query</code> to perform a find. This
    node uses the layout found in either <code>msg.payload.layout</code>, <code>msg.parameters.layout</code>, or this node's configuration as context for listing records. This node will also accept scripts and portals parameters. The scripts parameters are an array of scripts to run with the query. The portals parameter specifies the portal data to return in the query.<br/>The order of assignment for parameters are node configuration properties, message parameters, message payload parameter properties.</p>
    <h3>References</h3>
        <ul>
            <li><a href="https://github.com/Luidog/fms-api-client#list-records">List Method</a> - base client documentation</li>
            <li><a href="https://github.com/Luidog/fms-api-client#script-array-syntax">Scripts Array</a> - scripts array documentation</li>
            <li><a href="https://github.com/Luidog/fms-api-client#portal-array-syntax">Portals Array</a> - portals array documentation</li>
            <li><a href="https://github.com/Luidog/node-red-contrib-filemaker">Node-Red FileMaker</a> - the node's github repository</li>
            <li><a href="https://github.com/Luidog/fms-api-client">FMS API Client</a> - fms-api-client github repository</li>
        </ul>
</script>